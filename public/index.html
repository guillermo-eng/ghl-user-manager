<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Sasooness Law Group â€“ Team Manager</title>
  <link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=DM+Sans:wght@300;400;500&display=swap" rel="stylesheet"/>
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    :root {
      --navy: #1e2d5a; --navy2: #162246; --accent: #2a5caa; --bg: #f4f5f8;
      --surface: #ffffff; --border: #dde1ea; --text: #1a1f2e; --muted: #7b839a;
      --danger: #d94040; --success: #27916e; --radius: 10px;
    }
    html, body { height: 100%; background: var(--bg); color: var(--text); font-family: 'DM Sans', sans-serif; font-size: 15px; }
    .app { max-width: 1020px; margin: 0 auto; padding: 28px 24px; min-height: 100vh; }

    /* Header */
    .header {
      display: flex; align-items: center; justify-content: space-between;
      margin-bottom: 28px; flex-wrap: wrap; gap: 16px;
      background: var(--surface); border: 1px solid var(--border);
      border-radius: var(--radius); padding: 18px 24px;
      box-shadow: 0 2px 12px rgba(30,45,90,0.07);
    }
    .header-logo { height: 120px; width: auto; display: block; }
    .header-right { display: flex; flex-direction: column; align-items: flex-end; gap: 3px; }
    .header-title { font-family: 'Syne', sans-serif; font-size: 17px; font-weight: 700; color: var(--navy); }
    .header-sub { font-size: 12px; color: var(--muted); }

    /* Buttons */
    .btn {
      display: inline-flex; align-items: center; gap: 7px; padding: 9px 18px;
      border-radius: 7px; font-family: 'DM Sans', sans-serif; font-size: 14px;
      font-weight: 500; cursor: pointer; border: none; transition: all 0.16s ease; white-space: nowrap;
    }
    .btn-primary { background: var(--navy); color: #fff; }
    .btn-primary:hover { background: var(--navy2); transform: translateY(-1px); box-shadow: 0 4px 12px rgba(30,45,90,0.2); }
    .btn-danger { background: transparent; color: var(--danger); border: 1px solid var(--danger); padding: 6px 13px; font-size: 13px; }
    .btn-danger:hover { background: var(--danger); color: #fff; }
    .btn-ghost { background: transparent; color: var(--muted); border: 1px solid var(--border); }
    .btn-ghost:hover { color: var(--text); border-color: var(--muted); }
    .btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none !important; }

    /* Stats */
    .stats { display: flex; gap: 14px; margin-bottom: 20px; flex-wrap: wrap; }
    .stat-card {
      background: var(--surface); border: 1px solid var(--border); border-radius: var(--radius);
      padding: 16px 22px; flex: 1; min-width: 130px; box-shadow: 0 1px 6px rgba(30,45,90,0.05);
    }
    .stat-card .label { color: var(--muted); font-size: 11px; text-transform: uppercase; letter-spacing: 1px; font-weight: 500; }
    .stat-card .value { font-family: 'Syne', sans-serif; font-size: 30px; font-weight: 700; margin-top: 3px; color: var(--navy); }
    .stat-card .value.accent { color: var(--accent); }

    /* Toolbar */
    .toolbar { display: flex; gap: 10px; margin-bottom: 16px; flex-wrap: wrap; }
    .search-wrap { flex: 1; position: relative; min-width: 200px; }
    .search-wrap svg { position: absolute; left: 11px; top: 50%; transform: translateY(-50%); color: var(--muted); pointer-events: none; }
    .search-input {
      width: 100%; background: var(--surface); border: 1px solid var(--border); border-radius: 7px;
      color: var(--text); font-family: 'DM Sans', sans-serif; font-size: 14px;
      padding: 9px 12px 9px 36px; outline: none; transition: border-color 0.16s;
    }
    .search-input:focus { border-color: var(--accent); }
    .search-input::placeholder { color: var(--muted); }

    /* Table */
    .table-wrap { background: var(--surface); border: 1px solid var(--border); border-radius: var(--radius); overflow: hidden; box-shadow: 0 2px 12px rgba(30,45,90,0.06); }
    table { width: 100%; border-collapse: collapse; }
    thead { background: var(--navy); }
    th { padding: 13px 18px; text-align: left; font-family: 'Syne', sans-serif; font-size: 11px; font-weight: 600; text-transform: uppercase; letter-spacing: 1.1px; color: rgba(255,255,255,0.75); }
    td { padding: 14px 18px; border-bottom: 1px solid var(--border); font-size: 14px; vertical-align: middle; }
    tr:last-child td { border-bottom: none; }
    tbody tr { transition: background 0.13s; }
    tbody tr:hover { background: #f0f3fa; }
    .avatar { width: 36px; height: 36px; border-radius: 50%; background: linear-gradient(135deg, var(--navy), var(--accent)); display: flex; align-items: center; justify-content: center; font-family: 'Syne', sans-serif; font-size: 13px; font-weight: 700; color: #fff; flex-shrink: 0; }
    .name-cell { display: flex; align-items: center; gap: 11px; }
    .user-name { font-weight: 500; }
    .badge { display: inline-block; padding: 3px 10px; border-radius: 20px; font-size: 11px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.4px; }
    .badge-admin { background: rgba(30,45,90,0.1); color: var(--navy); }
    .badge-user  { background: rgba(42,92,170,0.1); color: var(--accent); }

    /* States */
    .state-row td { text-align: center; padding: 56px 20px; color: var(--muted); }
    .spinner { width: 26px; height: 26px; border: 3px solid var(--border); border-top-color: var(--navy); border-radius: 50%; animation: spin 0.7s linear infinite; margin: 0 auto 10px; }
    @keyframes spin { to { transform: rotate(360deg); } }

    /* Modal */
    .overlay { display: none; position: fixed; inset: 0; background: rgba(10,15,35,0.55); backdrop-filter: blur(3px); z-index: 100; align-items: center; justify-content: center; padding: 20px; }
    .overlay.active { display: flex; }
    .modal { background: var(--surface); border: 1px solid var(--border); border-radius: 14px; padding: 30px; width: 100%; max-width: 480px; animation: slideUp 0.2s ease; box-shadow: 0 20px 60px rgba(10,15,35,0.2); max-height: 90vh; overflow-y: auto; }
    @keyframes slideUp { from { opacity: 0; transform: translateY(18px); } to { opacity: 1; transform: translateY(0); } }
    .modal-header { display: flex; align-items: center; gap: 10px; margin-bottom: 20px; }
    .modal-header h2 { font-family: 'Syne', sans-serif; font-size: 19px; font-weight: 700; color: var(--navy); }
    .modal-divider { height: 1px; background: var(--border); margin: 16px 0; }
    .section-label { font-size: 11px; font-weight: 600; text-transform: uppercase; letter-spacing: 1px; color: var(--muted); margin-bottom: 10px; }
    .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
    .form-group { margin-bottom: 13px; }
    .form-group label { display: block; font-size: 12px; font-weight: 500; color: var(--muted); text-transform: uppercase; letter-spacing: 0.7px; margin-bottom: 5px; }
    .form-group input, .form-group select { width: 100%; background: var(--bg); border: 1px solid var(--border); border-radius: 7px; color: var(--text); font-family: 'DM Sans', sans-serif; font-size: 14px; padding: 9px 12px; outline: none; transition: border-color 0.16s; }
    .form-group input:focus, .form-group select:focus { border-color: var(--accent); background: #fff; }
    .copy-box { background: #eef2fa; border: 1px solid #c5cfe8; border-radius: 8px; padding: 14px 16px; margin-bottom: 14px; }
    .copy-box select { width: 100%; background: #fff; border: 1px solid var(--border); border-radius: 7px; color: var(--text); font-family: 'DM Sans', sans-serif; font-size: 14px; padding: 9px 12px; outline: none; margin-top: 8px; }
    .copy-box p { font-size: 12px; color: var(--muted); margin-top: 7px; }
    .modal-footer { display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px; }

    /* Toast */
    .toast-wrap { position: fixed; bottom: 22px; right: 22px; display: flex; flex-direction: column; gap: 9px; z-index: 200; }
    .toast { background: var(--surface); border: 1px solid var(--border); border-radius: 9px; padding: 11px 18px; font-size: 14px; animation: toastIn 0.22s ease; display: flex; align-items: center; gap: 9px; box-shadow: 0 4px 16px rgba(10,15,35,0.12); }
    .toast.success { border-color: var(--success); color: var(--success); }
    .toast.error   { border-color: var(--danger); color: var(--danger); }
    @keyframes toastIn { from { opacity: 0; transform: translateX(16px); } to { opacity: 1; transform: translateX(0); } }
  </style>
</head>
<body>
<div class="app">

  <!-- Header -->
  <div class="header">
    <img class="header-logo" src="https://assets.cdn.filesafe.space/h9Cescnz9vGFUmWHFp7c/media/695bfb7d6aaf166874ad789a.png" " alt="Sasooness Law Group" onerror="this.style.display='none'"/>
    <div class="header-right">
      <div class="header-title">Team Manager</div>
      <div class="header-sub">Sub-Account User Management</div>
    </div>
    <button class="btn btn-primary" onclick="openAddModal()">
      <svg width="15" height="15" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
      Add User
    </button>
  </div>

  <!-- Stats -->
  <div class="stats">
    <div class="stat-card"><div class="label">Total Users</div><div class="value accent" id="stat-total">â€”</div></div>
    <div class="stat-card"><div class="label">Admins</div><div class="value" id="stat-admins">â€”</div></div>
    <div class="stat-card"><div class="label">Standard Users</div><div class="value" id="stat-users">â€”</div></div>
  </div>

  <!-- Toolbar -->
  <div class="toolbar">
    <div class="search-wrap">
      <svg width="15" height="15" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
      <input type="text" class="search-input" placeholder="Search by name or emailâ€¦" id="search-input" oninput="filterUsers()"/>
    </div>
    <button class="btn btn-ghost" onclick="loadUsers()">
      <svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><polyline points="1 4 1 10 7 10"/><path d="M3.51 15a9 9 0 1 0 .49-3.09"/></svg>
      Refresh
    </button>
  </div>

  <!-- Table -->
  <div class="table-wrap">
    <table>
      <thead>
        <tr>
          <th>User</th><th>Email</th><th>Phone</th><th>Role</th>
          <th style="text-align:right">Actions</th>
        </tr>
      </thead>
      <tbody id="users-tbody">
        <tr class="state-row"><td colspan="5"><div class="spinner"></div>Loading usersâ€¦</td></tr>
      </tbody>
    </table>
  </div>
</div>

<!-- Add User Modal -->
<div class="overlay" id="add-modal">
  <div class="modal">
    <div class="modal-header">
      <svg width="20" height="20" fill="none" stroke="var(--navy)" stroke-width="2" viewBox="0 0 24 24"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
      <h2>Add New User</h2>
    </div>

    <!-- Permissions info -->
    <div class="copy-box">
      <div class="section-label">ðŸ“‹ Permissions</div>
      <p style="margin-top:6px; font-size:13px; color:var(--text);">
        <strong>Standard users</strong> automatically receive the standard team permission set.<br/>
        <strong>Admins</strong> receive full access.
      </p>
    </div>

    <div class="modal-divider"></div>
    <div class="section-label">User Details</div>

    <div class="form-row">
      <div class="form-group"><label>First Name *</label><input type="text" id="f-firstName" placeholder="John"/></div>
      <div class="form-group"><label>Last Name *</label><input type="text" id="f-lastName" placeholder="Doe"/></div>
    </div>
    <div class="form-group"><label>Email *</label><input type="email" id="f-email" placeholder="john@example.com"/></div>
    <div class="form-row">
      <div class="form-group"><label>Phone</label><input type="tel" id="f-phone" placeholder="+1 555 000 0000"/></div>
      <div class="form-group">
        <label>Role</label>
        <select id="f-role"><option value="user">User</option><option value="admin">Admin</option></select>
      </div>
    </div>

    <div class="modal-footer">
      <button class="btn btn-ghost" onclick="closeAddModal()">Cancel</button>
      <button class="btn btn-primary" id="submit-btn" onclick="addUser()">Create User</button>
    </div>
  </div>
</div>

<div class="toast-wrap" id="toast-wrap"></div>

<script>
  let allUsers = [];

  async function apiFetch(method, params = {}) {
    const base = "/api/users";
    let url = base;
    if (method === "DELETE" && params.userId) url += `?userId=${params.userId}`;
    const opts = { method, headers: { "Content-Type": "application/json" } };
    if (method === "POST") opts.body = JSON.stringify(params);
    const res = await fetch(url, opts);
    return res.json();
  }

  async function loadUsers() {
    setLoading(true);
    try {
      const data = await apiFetch("GET");
      allUsers = data.users || data || [];
      renderTable(allUsers);
      updateStats(allUsers);
    } catch (e) {
      showToast("Failed to load users", "error");
      setEmpty("Could not connect to the API.");
    }
  }

  function populateCopyDropdown(users) {
    const sel = document.getElementById("f-copy-from");
    sel.innerHTML = '<option value="">â€” None (use default permissions) â€”</option>';
    users.forEach(u => {
      const opt = document.createElement("option");
      opt.value = u.id;
      opt.textContent = `${u.firstName||""} ${u.lastName||""} (${u.role||"user"})`;
      sel.appendChild(opt);
    });
  }

  function renderTable(users) {
    const tbody = document.getElementById("users-tbody");
    if (!users.length) { setEmpty("No users found."); return; }
    tbody.innerHTML = users.map(u => {
      const initials = `${(u.firstName||"?")[0]}${(u.lastName||"")[0]||""}`.toUpperCase();
      const role = (u.role || "user").toLowerCase();
      const badgeClass = role === "admin" ? "badge-admin" : "badge-user";
      return `<tr>
        <td><div class="name-cell"><div class="avatar">${initials}</div><div class="user-name">${u.firstName||""} ${u.lastName||""}</div></div></td>
        <td>${u.email||"â€”"}</td>
        <td>${u.phone||"â€”"}</td>
        <td><span class="badge ${badgeClass}">${role}</span></td>
        <td style="text-align:right"><button class="btn btn-danger" onclick="deleteUser('${u.id}','${(u.firstName||"")} ${(u.lastName||"")}')">Remove</button></td>
      </tr>`;
    }).join("");
  }

  function setLoading(on) {
    if (on) document.getElementById("users-tbody").innerHTML =
      `<tr class="state-row"><td colspan="5"><div class="spinner"></div>Loadingâ€¦</td></tr>`;
  }
  function setEmpty(msg) {
    document.getElementById("users-tbody").innerHTML =
      `<tr class="state-row"><td colspan="5">${msg}</td></tr>`;
  }
  function updateStats(users) {
    document.getElementById("stat-total").textContent  = users.length;
    document.getElementById("stat-admins").textContent = users.filter(u=>(u.role||"").toLowerCase()==="admin").length;
    document.getElementById("stat-users").textContent  = users.filter(u=>(u.role||"").toLowerCase()!=="admin").length;
  }
  function filterUsers() {
    const q = document.getElementById("search-input").value.toLowerCase();
    renderTable(allUsers.filter(u=>`${u.firstName} ${u.lastName} ${u.email}`.toLowerCase().includes(q)));
  }

  async function deleteUser(id, name) {
    if (!confirm(`Remove "${name}" from the team?`)) return;
    try {
      await apiFetch("DELETE", { userId: id });
      showToast(`${name} removed`, "success");
      loadUsers();
    } catch (e) { showToast("Failed to remove user", "error"); }
  }

  function openAddModal()  { document.getElementById("add-modal").classList.add("active"); }
  function closeAddModal() {
    document.getElementById("add-modal").classList.remove("active");
    ["f-firstName","f-lastName","f-email","f-phone"].forEach(id => document.getElementById(id).value="");
    document.getElementById("f-role").value = "user";
  }

  async function addUser() {
    const firstName = document.getElementById("f-firstName").value.trim();
    const lastName  = document.getElementById("f-lastName").value.trim();
    const email     = document.getElementById("f-email").value.trim();
    const phone     = document.getElementById("f-phone").value.trim();
    const role      = document.getElementById("f-role").value;

    if (!firstName || !email) { showToast("First name and email are required", "error"); return; }

    const btn = document.getElementById("submit-btn");
    btn.disabled = true; btn.textContent = "Creatingâ€¦";
    try {
      const res = await apiFetch("POST", { firstName, lastName, email, phone, role });
      if (res.id || res.user) {
        showToast(`${firstName} added successfully!`, "success");
        closeAddModal(); loadUsers();
      } else {
        showToast(res.message || "Could not add user", "error");
      }
    } catch (e) { showToast("Failed to add user", "error"); }
    finally { btn.disabled = false; btn.textContent = "Create User"; }
  }

  function showToast(msg, type="success") {
    const wrap = document.getElementById("toast-wrap");
    const t = document.createElement("div");
    t.className = `toast ${type}`;
    t.innerHTML = `<span>${type==="success"?"âœ“":"âœ•"}</span> ${msg}`;
    wrap.appendChild(t);
    setTimeout(() => t.remove(), 3500);
  }

  document.getElementById("add-modal").addEventListener("click", function(e) {
    if (e.target === this) closeAddModal();
  });

  loadUsers();
</script>
</body>
</html>
